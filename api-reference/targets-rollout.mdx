---
title: "Trajectory Generation (Rollout)"
description: "Generate model responses to stimuli"
---

## Overview

Rollout generation creates model responses (trajectories) for each stimulus generated by a stim job. Rollout output is used as training data for bakes.

## Endpoints

### Run Rollout Job

Start a rollout job for the target.

**Endpoint**: `POST /v1/repo/{repo_name}/targets/{target_name}/rollout`

**Request**:

```bash
curl -X POST "https://bapi.bread.com.ai/v1/repo/my_repo/targets/coding_target/rollout" \
  -H "Authorization: Bearer $BREAD_API_KEY"
```

<ParamField path="target_name" type="string" required>
  Target name
</ParamField>

<ParamField path="repo_name" type="string" required>
  Repository name
</ParamField>

**Prerequisites**:
- Completed stim job (stim output must exist)
- Target must have `model_name` configured

<Check>
Verify stim job is complete before running rollout
</Check>

**Behavior**:
- Creates job marker and returns immediately
- Job executes asynchronously in background
- Idempotent: repeated calls return current state

**Response**: `200 OK`

```json
{
  "status": "running",
  "lines": 0,
  "parameters": {}
}
```

**Response Fields**:
- `status`: `string` - Job status (`'not_started'`, `'running'`, `'complete'`, or `'failed'`)
- `lines`: `number` - Number of trajectories generated
- `parameters`: `object` - Job configuration

---

### Get Rollout Status

Get rollout job status.

**Endpoint**: `GET /v1/repo/{repo_name}/targets/{target_name}/rollout`

**Request**:

```bash
curl -X GET "https://bapi.bread.com.ai/v1/repo/my_repo/targets/coding_target/rollout" \
  -H "Authorization: Bearer $BREAD_API_KEY"
```

<ParamField path="target_name" type="string" required>
  Target name
</ParamField>

<ParamField path="repo_name" type="string" required>
  Repository name
</ParamField>

**Response**: `200 OK`

```json
{
  "status": "complete",
  "lines": 500,
  "parameters": {}
}
```

**Response Fields**:
- `status`: `string` - `'not_started'`, `'running'`, `'complete'`, or `'failed'`
- `lines`: `number` - Number of generated trajectories
- `parameters`: `object` - Job configuration

---

### Get Rollout Output

Get paginated rollout output data.

**Endpoint**: `GET /v1/repo/{repo_name}/targets/{target_name}/rollout/output`

**Request**:

```bash
curl -X GET "https://bapi.bread.com.ai/v1/repo/my_repo/targets/coding_target/rollout/output?limit=100&offset=0" \
  -H "Authorization: Bearer $BREAD_API_KEY"
```

<ParamField path="target_name" type="string" required>
  Target name
</ParamField>

<ParamField path="repo_name" type="string" required>
  Repository name
</ParamField>

<ParamField path="limit" type="integer">
  Number of lines to return (max 1000)
</ParamField>

<ParamField path="offset" type="integer">
  Starting line number (0-indexed)
</ParamField>

**Response**: `200 OK`

```json
{
  "status": "complete",
  "lines": 500,
  "offset": 0,
  "limit": 100,
  "has_more": true,
  "output": [
    {
      "stimulus": "Write a function to reverse a string",
      "response": "def reverse_string(s):\n    return s[::-1]",
      "model": "Qwen/Qwen3-32B"
    },
    "..."
  ],
  "parameters": {}
}
```

**Response Fields**:
- `status`: `string` - Job status
- `lines`: `number` - Total number of trajectories
- `offset`: `number` - Starting offset
- `limit`: `number` - Page size
- `has_more`: `boolean` - Whether more data available
- `output`: `Array<object>` - List of generated trajectories
- `parameters`: `object` - Rollout configuration

---

## Complete Workflow Example

<Steps>
  <Step title="Verify Stim Complete">
    ```bash
    # Check stim status
    stim_response=$(curl -s -X GET "https://bapi.bread.com.ai/v1/repo/my_repo/targets/coding_target/stim" \
      -H "Authorization: Bearer $BREAD_API_KEY")
    
    stim_status=$(echo "$stim_response" | jq -r '.status')
    
    if [ "$stim_status" != "complete" ]; then
      echo "Stim job must complete before rollout"
      exit 1
    fi
    
    stim_lines=$(echo "$stim_response" | jq -r '.lines')
    echo "Stim complete with $stim_lines stimuli"
    ```
  </Step>

  <Step title="Start Rollout Job">
    ```bash
    curl -X POST "https://bapi.bread.com.ai/v1/repo/my_repo/targets/coding_target/rollout" \
      -H "Authorization: Bearer $BREAD_API_KEY"
    ```
  </Step>

  <Step title="Poll Status">
    ```bash
    # Poll status every 10 seconds (rollout takes longer)
    while true; do
      response=$(curl -s -X GET "https://bapi.bread.com.ai/v1/repo/my_repo/targets/coding_target/rollout" \
        -H "Authorization: Bearer $BREAD_API_KEY")
      
      status=$(echo "$response" | jq -r '.status')
      lines=$(echo "$response" | jq -r '.lines')
      
      if [ "$status" = "complete" ]; then
        echo "Complete! Generated $lines trajectories"
        break
      fi
      
      echo "Status: $status, Lines: $lines"
      sleep 10
    done
    ```
  </Step>

  <Step title="Fetch Output">
    ```bash
    curl -X GET "https://bapi.bread.com.ai/v1/repo/my_repo/targets/coding_target/rollout/output?limit=100" \
      -H "Authorization: Bearer $BREAD_API_KEY"
    ```
  </Step>
</Steps>

## Pagination Example

Fetch all rollout output:

```bash
#!/bin/bash

# Fetch all rollout output
offset=0
limit=1000
all_output=()

while true; do
  response=$(curl -s -X GET "https://bapi.bread.com.ai/v1/repo/my_repo/targets/coding_target/rollout/output?limit=$limit&offset=$offset" \
    -H "Authorization: Bearer $BREAD_API_KEY")
  
  # Extract output array
  output=$(echo "$response" | jq -r '.output[]')
  has_more=$(echo "$response" | jq -r '.has_more')
  
  # Process output
  while IFS= read -r line; do
    all_output+=("$line")
  done <<< "$output"
  
  count=${#all_output[@]}
  echo "Fetched $count trajectories..."
  
  if [ "$has_more" = "false" ]; then
    break
  fi
  
  offset=$((offset + limit))
done

echo "Total trajectories: ${#all_output[@]}"
```

## Understanding Trajectories

A trajectory represents the model's complete response to a stimulus:

```json
{
  "stimulus": "Write a function to reverse a string",
  "response": "def reverse_string(s):\n    return s[::-1]",
  "model": "Qwen/Qwen3-32B",
  "temperature": 1.0,
  "tokens": 25
}
```

## Multiple Trajectories Per Stimulus

Configure multiple responses per stimulus in target configuration:

```bash
curl -X POST "https://bapi.bread.com.ai/v1/repo/my_repo/targets" \
  -H "Authorization: Bearer $BREAD_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "target_name": "multi_traj_target",
    "template": "default",
    "overrides": {
      "model_name": "Qwen/Qwen3-32B",
      "num_traj_per_stimulus": 5,
      "temperature": 1.0
    }
  }'
```

<Tip>
Multiple trajectories per stimulus provide diverse training data and can improve model robustness.
</Tip>

## Best Practices

<AccordionGroup>
  <Accordion title="Verify Prerequisites" icon="list-check">
    Always check that stim job is complete and `model_name` is configured before running rollout
  </Accordion>

  <Accordion title="Poll Less Frequently" icon="clock">
    Rollout jobs can take longer than stim. Poll every 10-30 seconds instead of every 5 seconds
  </Accordion>

  <Accordion title="Monitor Progress" icon="chart-line">
    Check the `lines` field during polling to see generation progress
  </Accordion>

  <Accordion title="Handle Timeouts" icon="stopwatch">
    For large rollouts, configure appropriate timeout values on the client
  </Accordion>
</AccordionGroup>

## Error Handling

### Not Found (404)

Target doesn't exist:

```bash
curl -X POST "https://bapi.bread.com.ai/v1/repo/my_repo/targets/nonexistent/rollout" \
  -H "Authorization: Bearer $BREAD_API_KEY"
```

**Response**: `404 Not Found`

```json
{
  "error": "Target not found"
}
```

### Missing Prerequisites (400)

Stim job not complete or model_name not configured:

**Response**: `400 Bad Request`

```json
{
  "error": "Stim job must complete before running rollout"
}
```

or

```json
{
  "error": "model_name must be configured in target"
}
```

## Next Steps

<CardGroup cols={2}>
  <Card
    title="Bakes (Training)"
    icon="fire"
    href="/api-reference/bakes"
  >
    Use rollout data for model training
  </Card>
  <Card
    title="SDK Quickstart"
    icon="code"
    href="/sdk/quickstart"
  >
    Use the SDK for programmatic control
  </Card>
</CardGroup>

